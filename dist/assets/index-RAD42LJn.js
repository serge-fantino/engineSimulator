(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const r of t.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function s(a){if(a.ep)return;a.ep=!0;const t=i(a);fetch(a.href,t)}})();function z(p,e){if(e.length===0)return 0;if(p<=e[0][0])return e[0][1];if(p>=e[e.length-1][0])return e[e.length-1][1];for(let i=0;i<e.length-1;i++){const[s,a]=e[i],[t,r]=e[i+1];if(p>=s&&p<=t){const l=(p-s)/(t-s);return a+l*(r-a)}}return e[e.length-1][1]}function j(p,e,i){return z(p,i.torqueCurve)*Math.pow(Math.max(0,e),1.5)}function K(p,e){const s=p*e*(2*Math.PI/60)/1e3;return{kw:s,hp:s*1.341}}function J(p,e){return Math.max(e.idleRPM,Math.min(p,e.redlineRPM))}const Y=15;function X(p,e,i,s){if(p<e.redlineRPM-100)return{torqueMultiplier:1,newPhase:0,popTriggered:!1};const a=(i+s*Y)%1,t=a<.5,r=t&&i>=.5;return{torqueMultiplier:t?.05:.7,newPhase:a,popTriggered:r}}const I=2*Math.PI,q=800,Z=120;class D{_gear=0;_isShifting=!1;shiftTimer=0;lastShiftTime=0;_mode="automatic";profile;manualOverrideUntil=0;static MANUAL_OVERRIDE_DURATION_MS=2500;constructor(e){this.profile=e}get gear(){return this._gear}get isShifting(){return this._isShifting}get maxGear(){return this.profile.gearRatios.length}get mode(){return this._mode}set mode(e){this._mode=e}setProfile(e){this.profile=e,this._gear=0,this._isShifting=!1,this.manualOverrideUntil=0}speedToRPM(e,i){if(i<1||i>this.maxGear)return this.profile.idleRPM;const s=this.profile.gearRatios[i-1];return e*s*this.profile.finalDrive*60/(I*this.profile.wheelRadius)}rpmToSpeed(e,i){if(i<1||i>this.maxGear)return 0;const s=this.profile.gearRatios[i-1];return e*I*this.profile.wheelRadius/(s*this.profile.finalDrive*60)}update(e){this._isShifting&&(this.shiftTimer-=e*1e3,this.shiftTimer<=0&&(this._isShifting=!1))}checkAutoShift(e,i,s){if(this._mode!=="automatic"||this._isShifting||this._gear===0||s<this.manualOverrideUntil||s-this.lastShiftTime<q)return;const a=this.profile.peakPowerRPM*(.6+.35*i),t=this.profile.peakTorqueRPM*(.4+.2*i);e>a&&this._gear<this.maxGear?this.doShift(this._gear+1,s):e<t&&this._gear>1&&this.doShift(this._gear-1,s)}shiftUp(e){this._isShifting||this._gear>=this.maxGear||e-this.lastShiftTime<q||this.doShift(this._gear+1,e)}shiftDown(e,i=0){this._isShifting||this._gear<=0||e-this.lastShiftTime<q||this._gear===1&&i>=1||this.doShift(this._gear-1,e)}manualOverrideShift(e,i){if(this._isShifting||i-this.lastShiftTime<q||this._gear===0)return;const s=e==="up"?Math.min(this._gear+1,this.maxGear):Math.max(this._gear-1,1);s!==this._gear&&(this.doShift(s,i),this.manualOverrideUntil=i+D.MANUAL_OVERRIDE_DURATION_MS)}doShift(e,i){this._isShifting=!0,this.shiftTimer=Z,this.lastShiftTime=i,this._gear=e}reset(){this._gear=0,this._isShifting=!1,this.shiftTimer=0,this.lastShiftTime=0,this.manualOverrideUntil=0}}const ee=1.225,O=9.81,te=.85,ie=[0,.25,.15,.1,.08,.06,.05,.04,.035],se=1.2;function ae(p){switch(p.driveType||"rwd"){case"awd":return .95;case"fwd":return .55;case"rwd":return .5;default:return .5}}class L{_speedMs=0;_accelerationMs2=0;_wheelSlip=0;profile;constructor(e){this.profile=e}get speedMs(){return this._speedMs}get accelerationMs2(){return this._accelerationMs2}get wheelSlip(){return this._wheelSlip}setProfile(e){this.profile=e}update(e,i,s,a,t){const r=this.profile;let l=0;if(!t&&s>=1&&s<=r.gearRatios.length){const R=r.gearRatios[s-1];l=i*R*r.finalDrive*te/r.wheelRadius}const c=ae(r),n=se*r.vehicleMass*c*O;this._wheelSlip=0,l>n&&l>0&&(this._wheelSlip=Math.min(1,(l-n)/n),l=n*(1-.3*this._wheelSlip));const o=r.vehicleMass*O*.8,d=a*o,h=.5*r.dragCoefficient*ee*r.frontalArea*this._speedMs*this._speedMs,u=r.rollingResistance*r.vehicleMass*O,w=l-d-h-u,f=ie[s]??.05,v=r.vehicleMass*(1+f);return this._accelerationMs2=w/v,this._speedMs=Math.max(0,this._speedMs+this._accelerationMs2*e),{speedMs:this._speedMs,accelerationMs2:this._accelerationMs2,wheelSlip:this._wheelSlip}}reset(){this._speedMs=0,this._accelerationMs2=0,this._wheelSlip=0}}class V{boostActual=0;bovTriggered=!1;bovTime=0;prevThrottle=0;config;constructor(e){this.config=e}setConfig(e){this.config=e}update(e,i,s){const a=this.config;let t=0;if(e>=a.boostThresholdRPM){const n=Math.min(1,(e-a.boostThresholdRPM)/2e3);t=a.maxBoostBar*i*n}const r=a.spoolTimeSec*(a.boostThresholdRPM/Math.max(e,a.boostThresholdRPM)),l=Math.max(r,.01);this.boostActual+=(t-this.boostActual)*(s/l);let c=0;return a.hasBOV&&i<.1&&this.boostActual>.3&&this.prevThrottle>.3&&(this.bovTriggered=!0,this.bovTime=0,this.boostActual*=.5),this.bovTriggered&&(this.bovTime+=s,c=this.bovTime<.01?this.bovTime/.01:Math.exp(-(this.bovTime-.01)/.2),c<.01&&(this.bovTriggered=!1,c=0)),this.prevThrottle=i,{boostBar:Math.max(0,this.boostActual),bovActive:this.bovTriggered,bovEnvelope:c}}reset(){this.boostActual=0,this.bovTriggered=!1,this.bovTime=0,this.prevThrottle=0}}class oe{lowpass;peakingFilters;_input;_output;get input(){return this._input}get output(){return this._output}constructor(e,i){this.lowpass=e.createBiquadFilter(),this.lowpass.type="lowpass",this.lowpass.frequency.value=i.lowpassBaseFreq,this.lowpass.Q.value=i.lowpassQ,this.peakingFilters=i.resonances.map(a=>{const t=e.createBiquadFilter();return t.type="peaking",t.frequency.value=a.freq,t.Q.value=a.Q,t.gain.value=a.gainDB,t});let s=this.lowpass;for(const a of this.peakingFilters)s.connect(a),s=a;this._input=this.lowpass,this._output=this.peakingFilters.length>0?this.peakingFilters[this.peakingFilters.length-1]:this.lowpass}update(e,i){const s=i.lowpassBaseFreq+e*i.lowpassRpmScale;this.lowpass.frequency.setTargetAtTime(s,0,.03)}disconnect(){this.lowpass.disconnect();for(const e of this.peakingFilters)e.disconnect()}}class ne{turboOsc;turboOsc2;turboGain;turboBandpass;bovGain;bovBandpass;mixerGain;ctx;noiseBuffer;activeBovSource=null;get output(){return this.mixerGain}constructor(e,i){this.ctx=e,this.turboOsc=e.createOscillator(),this.turboOsc.type="sine",this.turboOsc.frequency.value=2e3,this.turboOsc2=e.createOscillator(),this.turboOsc2.type="sine",this.turboOsc2.frequency.value=4e3,this.turboBandpass=e.createBiquadFilter(),this.turboBandpass.type="bandpass",this.turboBandpass.frequency.value=3e3,this.turboBandpass.Q.value=4,this.turboGain=e.createGain(),this.turboGain.gain.value=0;const s=e.createGain();s.gain.value=.3,this.turboOsc.connect(this.turboBandpass),this.turboOsc2.connect(s),s.connect(this.turboBandpass),this.turboBandpass.connect(this.turboGain),this.bovBandpass=e.createBiquadFilter(),this.bovBandpass.type="bandpass",this.bovBandpass.frequency.value=1200,this.bovBandpass.Q.value=3,this.bovGain=e.createGain(),this.bovGain.gain.value=0,this.bovBandpass.connect(this.bovGain),this.mixerGain=e.createGain(),this.mixerGain.gain.value=1,this.turboGain.connect(this.mixerGain),this.bovGain.connect(this.mixerGain),this.noiseBuffer=this.createNoiseBuffer(.5),this.turboOsc.start(),this.turboOsc2.start()}update(e,i){const s=2e3+e*8e3,a=e*.12;this.turboOsc.frequency.setTargetAtTime(s,0,.05),this.turboOsc2.frequency.setTargetAtTime(s*2,0,.05),this.turboGain.gain.setTargetAtTime(a,0,.03),this.turboBandpass.frequency.setTargetAtTime(s,0,.05)}triggerBOV(e){if(e>.01&&!this.activeBovSource){const i=this.ctx.createBufferSource();i.buffer=this.noiseBuffer,i.connect(this.bovBandpass),i.start(),this.activeBovSource=i,i.onended=()=>{this.activeBovSource=null}}this.bovGain.gain.setTargetAtTime(e*.4,0,.01)}disconnect(){this.turboOsc.stop(),this.turboOsc2.stop(),this.turboGain.disconnect(),this.bovGain.disconnect(),this.mixerGain.disconnect()}createNoiseBuffer(e){const i=Math.floor(this.ctx.sampleRate*e),s=this.ctx.createBuffer(1,i,this.ctx.sampleRate),a=s.getChannelData(0);for(let t=0;t<i;t++)a[t]=Math.random()*2-1;return s}}class re{ctx=null;workletNode=null;exhaustFilter=null;turboAudio=null;masterGain=null;compressor=null;profile=null;isRunning=!1;popNoiseBuffer=null;activePopSource=null;popGain=null;_crackleActive=!1;squealSource=null;squealGain=null;squealNoiseBuffer=null;async initialize(e){this.profile=e,this.ctx=new AudioContext({latencyHint:"interactive",sampleRate:44100});const i=new URL(""+new URL("engine-worklet-BQmEtZle.js",import.meta.url).href,import.meta.url);await this.ctx.audioWorklet.addModule(i.href),this.buildGraph(e)}buildGraph(e){const i=this.ctx;this.workletNode=new AudioWorkletNode(i,"engine-worklet",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[1]}),this.exhaustFilter=new oe(i,e.exhaustConfig),e.turbo&&(this.turboAudio=new ne(i,e.turbo)),this.compressor=i.createDynamicsCompressor(),this.compressor.threshold.value=-6,this.compressor.knee.value=3,this.compressor.ratio.value=12,this.compressor.attack.value=.003,this.compressor.release.value=.1,this.popGain=i.createGain(),this.popGain.gain.value=1,this.masterGain=i.createGain(),this.masterGain.gain.value=.7,this.workletNode.connect(this.exhaustFilter.input),this.exhaustFilter.output.connect(this.compressor),this.turboAudio&&this.turboAudio.output.connect(this.compressor),this.compressor.connect(this.masterGain),this.popGain.connect(this.masterGain),this.masterGain.connect(i.destination),this.setupTireSqueal()}start(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume(),this.isRunning=!0}stop(){if(this.isRunning=!1,this.squealSource){try{this.squealSource.stop()}catch{}this.squealSource=null}this.ctx&&this.ctx.state==="running"&&this.ctx.suspend()}update(e){!this.workletNode||!this.profile||!this.isRunning||(this.workletNode.port.postMessage({type:"params",params:{rpm:e.rpm,throttle:e.throttle,cylinders:this.profile.cylinders,engineType:this.profile.type,spectralRolloff:this.profile.harmonicProfile.spectralRolloff,firingHarmonicBoost:this.profile.harmonicProfile.firingHarmonicBoost,numHarmonics:this.profile.harmonicProfile.numHarmonics,boostBar:e.boostBar,isShifting:e.isShifting}}),this.exhaustFilter?.update(e.rpm,this.profile.exhaustConfig),this.turboAudio&&this.turboAudio.update(e.boostBar,e.rpm))}triggerBOV(e){this.turboAudio?.triggerBOV(e)}triggerRevLimiterPop(){if(!this.ctx||!this.popGain)return;const e=this.ctx;if(!this.popNoiseBuffer){const l=Math.floor(e.sampleRate*.15);this.popNoiseBuffer=e.createBuffer(1,l,e.sampleRate);const c=this.popNoiseBuffer.getChannelData(0);for(let n=0;n<l;n++)c[n]=Math.random()*2-1}if(this.activePopSource)return;const i=e.createBufferSource();i.buffer=this.popNoiseBuffer;const s=e.createBiquadFilter();s.type="bandpass",s.frequency.value=600+Math.random()*600,s.Q.value=4;const a=e.createGain(),t=e.currentTime,r=.05+Math.random()*.05;a.gain.setValueAtTime(0,t),a.gain.linearRampToValueAtTime(.9,t+.005),a.gain.exponentialRampToValueAtTime(.01,t+r),i.connect(s),s.connect(a),a.connect(this.popGain),i.start(t),i.stop(t+.15),this.activePopSource=i,i.onended=()=>{this.activePopSource=null}}triggerDecelCrackle(){if(!this.ctx||!this.popGain||this._crackleActive)return;const e=this.ctx;if(this._crackleActive=!0,!this.popNoiseBuffer){const t=Math.floor(e.sampleRate*.15);this.popNoiseBuffer=e.createBuffer(1,t,e.sampleRate);const r=this.popNoiseBuffer.getChannelData(0);for(let l=0;l<t;l++)r[l]=Math.random()*2-1}const i=3+Math.floor(Math.random()*5);let s=0;const a=e.currentTime;for(let t=0;t<i;t++){const r=.03+Math.random()*.05;s+=r;const l=e.createBufferSource();l.buffer=this.popNoiseBuffer;const c=e.createBiquadFilter();c.type="bandpass",c.frequency.value=600+Math.random()*900,c.Q.value=3+Math.random()*2;const n=e.createGain(),o=(.6-t*.06)*(.5+Math.random()*.5),d=a+s;n.gain.setValueAtTime(0,d),n.gain.linearRampToValueAtTime(Math.max(.1,o),d+.003),n.gain.exponentialRampToValueAtTime(.01,d+.04),l.connect(c),c.connect(n),n.connect(this.popGain),l.start(d),l.stop(d+.06)}setTimeout(()=>{this._crackleActive=!1},(s+.1)*1e3)}setupTireSqueal(){if(!this.ctx||!this.masterGain)return;const e=this.ctx,i=Math.floor(e.sampleRate*2);this.squealNoiseBuffer=e.createBuffer(1,i,e.sampleRate);const s=this.squealNoiseBuffer.getChannelData(0);for(let r=0;r<i;r++)s[r]=Math.random()*2-1;const a=e.createBufferSource();a.buffer=this.squealNoiseBuffer,a.loop=!0;const t=e.createBiquadFilter();t.type="bandpass",t.frequency.value=3e3,t.Q.value=3,this.squealGain=e.createGain(),this.squealGain.gain.value=0,a.connect(t),t.connect(this.squealGain),this.squealGain.connect(this.masterGain),a.start(),this.squealSource=a}updateTireSqueal(e){if(!this.squealGain||!this.ctx)return;const i=e>.1?Math.min(.5,e*.8):0;this.squealGain.gain.setTargetAtTime(i,this.ctx.currentTime,.05)}async playStarterSound(){if(!this.ctx)return;const e=this.ctx,i=e.currentTime,s=.5,a=Math.floor(e.sampleRate*s),t=e.createBuffer(1,a,e.sampleRate),r=t.getChannelData(0);for(let o=0;o<a;o++)r[o]=Math.random()*2-1;const l=e.createBufferSource();l.buffer=t;const c=e.createBiquadFilter();c.type="bandpass",c.Q.value=5,c.frequency.setValueAtTime(100,i),c.frequency.linearRampToValueAtTime(500,i+.4);const n=e.createGain();return n.gain.setValueAtTime(0,i),n.gain.linearRampToValueAtTime(.3,i+.05),n.gain.setValueAtTime(.3,i+.35),n.gain.linearRampToValueAtTime(0,i+.45),l.connect(c),c.connect(n),n.connect(this.compressor||e.destination),l.start(i),l.stop(i+s),new Promise(o=>setTimeout(o,500))}setVolume(e){this.masterGain&&this.masterGain.gain.setTargetAtTime(Math.max(0,Math.min(1,e)),0,.05)}async switchProfile(e){if(this.ctx){if(this.masterGain&&this.masterGain.gain.setTargetAtTime(0,this.ctx.currentTime,.15),await new Promise(i=>setTimeout(i,300)),this.squealSource){try{this.squealSource.stop()}catch{}this.squealSource=null}this.workletNode?.disconnect(),this.exhaustFilter?.disconnect(),this.turboAudio?.disconnect(),this.compressor?.disconnect(),this.popGain?.disconnect(),this.masterGain?.disconnect(),this.turboAudio=null,this.profile=e,this.buildGraph(e),this.masterGain&&(this.masterGain.gain.value=0,this.masterGain.gain.setTargetAtTime(.7,this.ctx.currentTime,.15))}}}class E{canvas;ctx2d;data=[];timer=0;isRecording=!1;milestones=[];maxSpeedKmh;maxTime=10;static SPEED_THRESHOLDS=[100,200];constructor(e,i){this.maxSpeedKmh=this.calculateDisplayMax(i),this.canvas=document.createElement("canvas"),this.canvas.id="perf-graph-canvas",this.ctx2d=this.canvas.getContext("2d"),document.getElementById(e).appendChild(this.canvas),this.setupResize(),this.resizeCanvas()}setProfile(e){this.maxSpeedKmh=this.calculateDisplayMax(e),this.reset()}reset(){this.data=[],this.milestones=[],this.timer=0,this.isRecording=!1}update(e){if(this.isRecording||e.gear>=1&&e.throttle>.1&&e.speedKmh<5&&(this.isRecording=!0,this.data=[],this.milestones=[],this.timer=0),!this.isRecording){this.draw();return}if(e.brake>.3||e.gear===0){this.isRecording=!1,this.draw();return}this.timer+=1/60,this.data.push({time:this.timer,speedKmh:e.speedKmh});for(const i of E.SPEED_THRESHOLDS)!this.milestones.find(s=>s.speedKmh===i)&&e.speedKmh>=i&&this.milestones.push({speedKmh:i,time:this.timer});this.timer>this.maxTime-1&&(this.maxTime=Math.ceil(this.timer+5)),this.data.length>1200&&(this.data=this.data.filter((i,s)=>s%2===0)),this.draw()}draw(){const e=this.ctx2d,i=this.canvas.width/(window.devicePixelRatio||1),s=this.canvas.height/(window.devicePixelRatio||1),a=window.devicePixelRatio||1;e.setTransform(a,0,0,a,0,0),e.clearRect(0,0,i,s);const t={top:10,right:12,bottom:22,left:40},r=i-t.left-t.right,l=s-t.top-t.bottom;if(r<20||l<20)return;e.fillStyle="rgba(15, 21, 41, 0.6)",e.strokeStyle="#2a2a4a",e.lineWidth=1,e.beginPath(),e.roundRect(0,0,i,s,6),e.fill(),e.stroke(),e.font="9px system-ui",e.textAlign="right",e.textBaseline="middle";const c=this.maxSpeedKmh>200?100:50;for(let o=0;o<=this.maxSpeedKmh;o+=c){const d=t.top+l-o/this.maxSpeedKmh*l;e.strokeStyle="#1e293b",e.beginPath(),e.moveTo(t.left,d),e.lineTo(t.left+r,d),e.stroke(),e.fillStyle="#556",e.fillText(String(o),t.left-4,d)}for(const o of E.SPEED_THRESHOLDS){if(o>this.maxSpeedKmh)continue;const d=t.top+l-o/this.maxSpeedKmh*l;e.strokeStyle=o===100?"rgba(234, 179, 8, 0.4)":"rgba(233, 69, 96, 0.4)",e.setLineDash([4,4]),e.beginPath(),e.moveTo(t.left,d),e.lineTo(t.left+r,d),e.stroke(),e.setLineDash([])}e.textAlign="center",e.textBaseline="top";const n=this.maxTime<=10?2:5;for(let o=0;o<=this.maxTime;o+=n){const d=t.left+o/this.maxTime*r;e.fillStyle="#556",e.fillText(`${o}s`,d,t.top+l+4)}if(this.data.length>1){e.beginPath(),e.strokeStyle="#22c55e",e.lineWidth=2,e.lineJoin="round";for(let o=0;o<this.data.length;o++){const d=this.data[o],h=t.left+d.time/this.maxTime*r,u=t.top+l-d.speedKmh/this.maxSpeedKmh*l;o===0?e.moveTo(h,u):e.lineTo(h,u)}e.stroke()}for(const o of this.milestones){const d=t.left+o.time/this.maxTime*r,h=t.top+l-o.speedKmh/this.maxSpeedKmh*l;e.beginPath(),e.arc(d,h,4,0,Math.PI*2),e.fillStyle=o.speedKmh===100?"#eab308":"#e94560",e.fill();const u=`0-${o.speedKmh}: ${o.time.toFixed(1)}s`;e.font="bold 10px system-ui";const f=e.measureText(u).width+10,v=16,R=Math.min(d+6,t.left+r-f),T=h-v-4;e.fillStyle=o.speedKmh===100?"rgba(234, 179, 8, 0.85)":"rgba(233, 69, 96, 0.85)",e.beginPath(),e.roundRect(R,T,f,v,3),e.fill(),e.fillStyle="#fff",e.textAlign="left",e.textBaseline="middle",e.fillText(u,R+5,T+v/2)}this.isRecording&&(e.fillStyle="#e94560",e.beginPath(),e.arc(i-16,14,4,0,Math.PI*2),e.fill(),e.fillStyle="#889",e.font="9px system-ui",e.textAlign="right",e.textBaseline="middle",e.fillText("REC",i-24,14))}calculateDisplayMax(e){const i=e.peakPower*1e3,s=1.225;let a=0,t=200;for(let l=0;l<50;l++){const c=(a+t)/2,n=.5*e.dragCoefficient*s*e.frontalArea*c*c*c,o=e.rollingResistance*e.vehicleMass*9.81*c;n+o<i*.85?a=c:t=c}const r=(a+t)/2*3.6;return Math.ceil(r/50)*50}setupResize(){new ResizeObserver(()=>this.resizeCanvas()).observe(this.canvas.parentElement)}resizeCanvas(){const i=this.canvas.parentElement.getBoundingClientRect(),s=window.devicePixelRatio||1,a=Math.min(i.width,600),t=120;this.canvas.width=a*s,this.canvas.height=t*s,this.canvas.style.width=`${a}px`,this.canvas.style.height=`${t}px`,this.draw()}}class le{canvas;ctx2d;gaugesEl;profile;logicalW=600;logicalH=500;lastState=null;speedVal;accelVal;powerVal;torqueVal;boostVal;boostCard;speedBarFill;speedBarValue;speedBarMax;maxSpeedKmh;perfGraph;constructor(e,i,s){this.canvas=document.getElementById(e),this.ctx2d=this.canvas.getContext("2d"),this.gaugesEl=document.getElementById(i),this.profile=s,this.maxSpeedKmh=this.calculateMaxSpeed(s),this.buildSpeedBar(),this.buildGauges(),this.setupResize(),this.resizeCanvas(),this.perfGraph=new E("dashboard-container",s),this.drawTachometer(0,0,!1,!1)}setProfile(e){this.profile=e,this.boostCard.style.display=e.turbo?"":"none",this.maxSpeedKmh=this.calculateMaxSpeed(e),this.speedBarMax.textContent=Math.round(this.maxSpeedKmh).toString(),this.perfGraph.setProfile(e),this.lastState=null,this.drawTachometer(0,0,!1,!1)}render(e){this.lastState=e,this.drawTachometer(e.rpm,e.gear,e.isShifting,e.revLimiterActive),this.updateGauges(e),this.updateSpeedBar(e.speedKmh),this.perfGraph.update(e)}calculateMaxSpeed(e){const i=e.peakPower*1e3,s=1.225,a=e.dragCoefficient,t=e.frontalArea,r=e.rollingResistance,l=e.vehicleMass,c=9.81,n=.85;let o=0,d=200;for(let f=0;f<50;f++){const v=(o+d)/2,R=.5*a*s*t*v*v*v,T=r*l*c*v;R+T<i*n?o=v:d=v}const h=(o+d)/2,u=e.gearRatios[e.gearRatios.length-1],w=e.redlineRPM*2*Math.PI*e.wheelRadius/(u*e.finalDrive*60);return Math.min(h,w)*3.6}buildSpeedBar(){const e=this.canvas.parentElement,i=document.createElement("div");i.id="tacho-area";const s=document.createElement("div");s.className="speed-bar-container",s.innerHTML=`
      <div class="speed-bar-max" id="speed-bar-max">${Math.round(this.maxSpeedKmh)}</div>
      <div class="speed-bar-track">
        <div class="speed-bar-fill" id="speed-bar-fill"></div>
      </div>
      <div class="speed-bar-value" id="speed-bar-value">0</div>
      <div class="speed-bar-unit">km/h</div>
    `,e.insertBefore(i,this.canvas),i.appendChild(s),i.appendChild(this.canvas),this.speedBarFill=document.getElementById("speed-bar-fill"),this.speedBarValue=document.getElementById("speed-bar-value"),this.speedBarMax=document.getElementById("speed-bar-max")}updateSpeedBar(e){const i=Math.min(100,e/this.maxSpeedKmh*100);this.speedBarFill.style.height=`${i}%`,this.speedBarValue.textContent=e.toFixed(0)}buildGauges(){this.gaugesEl.innerHTML="";const e=[{id:"speed",label:"Vitesse",unit:"km/h"},{id:"accel",label:"Accélération",unit:"G"},{id:"power",label:"Puissance",unit:"ch"},{id:"torque",label:"Couple",unit:"Nm"},{id:"boost",label:"Boost",unit:"bar"}];for(const i of e){const s=document.createElement("div");s.className="gauge-card",s.id=`gauge-${i.id}`,s.innerHTML=`
        <div class="gauge-label">${i.label}</div>
        <div>
          <span class="gauge-value" id="val-${i.id}">0</span>
          <span class="gauge-unit">${i.unit}</span>
        </div>
      `,this.gaugesEl.appendChild(s)}this.speedVal=document.getElementById("val-speed"),this.accelVal=document.getElementById("val-accel"),this.powerVal=document.getElementById("val-power"),this.torqueVal=document.getElementById("val-torque"),this.boostVal=document.getElementById("val-boost"),this.boostCard=document.getElementById("gauge-boost"),this.boostCard.style.display=this.profile.turbo?"":"none"}updateGauges(e){this.speedVal.textContent=e.speedKmh.toFixed(0),this.accelVal.textContent=e.accelerationG.toFixed(2),this.powerVal.textContent=e.powerHp.toFixed(0),this.torqueVal.textContent=e.torqueNm.toFixed(0),this.profile.turbo&&(this.boostVal.textContent=e.boostBar.toFixed(2))}drawTachometer(e,i,s,a){const t=this.ctx2d,r=this.logicalW,l=this.logicalH,c=r/2,n=l*.52,o=Math.min(r,l)*.36,d=window.devicePixelRatio||1;t.setTransform(d,0,0,d,0,0),t.clearRect(0,0,r,l);const h=5/4*Math.PI,u=-1/4*Math.PI,w=3/2*Math.PI,f=Math.ceil(this.profile.redlineRPM/1e3)*1e3,v=this.profile.redlineRPM;t.beginPath(),t.arc(c,n,o,h,u,!1),t.lineWidth=18,t.strokeStyle="#1e293b",t.stroke();const R=h+v/f*w;t.beginPath(),t.arc(c,n,o,R,u,!1),t.lineWidth=18,t.strokeStyle="rgba(233, 69, 96, 0.3)",t.stroke();const T=Math.min(e,f)/f,k=h+T*w,M=e>=v?"#e94560":"#22c55e";t.beginPath(),t.arc(c,n,o,h,k,!1),t.lineWidth=18,t.strokeStyle=M,t.lineCap="round",t.stroke(),t.lineCap="butt";const S=Math.max(11,o*.1);t.font=`${S}px system-ui`,t.textAlign="center",t.textBaseline="middle";for(let m=0;m<=f;m+=1e3){const g=h+m/f*w,x=Math.cos(g),P=Math.sin(g),y=o-12,C=o+12;t.beginPath(),t.moveTo(c+y*x,n+y*P),t.lineTo(c+C*x,n+C*P),t.lineWidth=2,t.strokeStyle=m>=v?"#e94560":"#556",t.stroke();const _=o+24;t.fillStyle=m>=v?"#e94560":"#889",t.fillText(String(m/1e3),c+_*x,n+_*P)}for(let m=500;m<f;m+=1e3){const g=h+m/f*w,x=Math.cos(g),P=Math.sin(g);t.beginPath(),t.moveTo(c+(o-6)*x,n+(o-6)*P),t.lineTo(c+(o+6)*x,n+(o+6)*P),t.lineWidth=1,t.strokeStyle="#334",t.stroke()}const $=h+Math.min(e,f)/f*w,B=o-22;t.save(),t.shadowColor=M,t.shadowBlur=8,t.beginPath(),t.moveTo(c,n),t.lineTo(c+B*Math.cos($),n+B*Math.sin($)),t.lineWidth=3,t.strokeStyle=M,t.stroke(),t.restore(),t.beginPath(),t.arc(c,n,6,0,Math.PI*2),t.fillStyle="#445",t.fill(),t.fillStyle=a?"#e94560":"#eee",t.font=`bold ${Math.max(20,o*.22)}px system-ui`,t.textAlign="center",t.fillText(Math.round(e).toString(),c,n+o*.32),t.font=`${Math.max(10,o*.08)}px system-ui`,t.fillStyle="#667",t.fillText("RPM",c,n+o*.44);const G=i===0?"N":String(i);if(t.font=`bold ${Math.max(24,o*.2)}px system-ui`,t.fillStyle=s?"#eab308":"#22c55e",t.fillText(G,c,n-o*.12),this.lastState&&(this.lastState.launchControlActive&&Math.sin(Date.now()*.01)>0&&(t.fillStyle="#eab308",t.font=`bold ${Math.max(10,o*.09)}px system-ui`,t.textAlign="center",t.fillText("LC",c,n+o*.58)),this.lastState.wheelSlip>.01)){const m=o*1.2,g=6,x=c-m/2,P=n+o*.68;t.fillStyle="#1e293b",t.beginPath(),t.roundRect(x,P,m,g,3),t.fill();const y=Math.min(1,this.lastState.wheelSlip),C=m*y,_=y<.3?"#22c55e":y<.6?"#eab308":"#e94560";t.fillStyle=_,t.beginPath(),t.roundRect(x,P,C,g,3),t.fill(),t.fillStyle="#889",t.font=`${Math.max(8,o*.06)}px system-ui`,t.textAlign="center",t.fillText(`SLIP ${Math.round(y*100)}%`,c,P+g+10)}}setupResize(){new ResizeObserver(()=>this.resizeCanvas()).observe(this.canvas.parentElement)}resizeCanvas(){const i=this.canvas.parentElement.getBoundingClientRect(),s=window.devicePixelRatio||1,a=Math.min(i.width-50,600),t=Math.max(180,a*.75);this.logicalW=a,this.logicalH=t,this.canvas.width=a*s,this.canvas.height=t*s,this.canvas.style.width=`${a}px`,this.canvas.style.height=`${t}px`,this.lastState&&this.render(this.lastState)}}class ce{throttle=0;brake=0;keysDown=new Set;_shiftUpPressed=!1;_shiftDownPressed=!1;_transmissionMode="automatic";container;throttleSlider;brakeSlider;throttleValEl;brakeValEl;gearNumberEl;autoBtn;manualBtn;powerBtn;volumeCallback=null;powerCallback=null;_isEngineOn=!1;constructor(e){this.container=document.getElementById(e),this.buildUI(),this.setupKeyboard()}get transmissionMode(){return this._transmissionMode}onVolumeChange(e){this.volumeCallback=e}onPowerChange(e){this.powerCallback=e}updateGearDisplay(e,i){const s=e===0?"N":String(e);this.gearNumberEl.textContent=s,this.gearNumberEl.className=i?"gear-number shifting":"gear-number"}update(e){this.keysDown.has("w")||this.keysDown.has("arrowup")?this.throttle=Math.min(1,this.throttle+3*e):this.throttle=Math.max(0,this.throttle-5*e),this.keysDown.has("s")||this.keysDown.has("arrowdown")?this.brake=Math.min(1,this.brake+3*e):this.brake=Math.max(0,this.brake-5*e);const a=parseFloat(this.throttleSlider.value)/100,t=parseFloat(this.brakeSlider.value)/100,r=Math.max(this.throttle,a),l=Math.max(this.brake,t);this.throttleValEl.textContent=`${Math.round(r*100)}%`,this.brakeValEl.textContent=`${Math.round(l*100)}%`;const c={throttle:r,brake:l,shiftUpPressed:this._shiftUpPressed,shiftDownPressed:this._shiftDownPressed,transmissionMode:this._transmissionMode};return this._shiftUpPressed=!1,this._shiftDownPressed=!1,c}buildUI(){this.container.innerHTML=`
      <div class="control-section power-section">
        <button class="power-btn" id="power-btn" title="Démarrer / Arrêter le moteur">
          <span class="power-icon">⏻</span>
        </button>
      </div>

      <div class="control-section">
        <div class="control-label">Pédales</div>
        <div class="pedal-container">
          <div class="pedal-wrapper">
            <span class="pedal-value" id="throttle-val">0%</span>
            <input type="range" min="0" max="100" value="0"
                   class="pedal-slider throttle" id="throttle-slider" orient="vertical">
            <span class="pedal-name">Gaz</span>
          </div>
          <div class="pedal-wrapper">
            <span class="pedal-value" id="brake-val">0%</span>
            <input type="range" min="0" max="100" value="0"
                   class="pedal-slider brake" id="brake-slider" orient="vertical">
            <span class="pedal-name">Frein</span>
          </div>
        </div>
      </div>

      <div class="control-section">
        <div class="control-label">Rapport</div>
        <div class="gear-display">
          <button class="gear-btn" id="gear-down">◀</button>
          <span class="gear-number" id="gear-number">N</span>
          <button class="gear-btn" id="gear-up">▶</button>
        </div>
      </div>

      <div class="control-section">
        <div class="control-label">Transmission</div>
        <div class="mode-toggle">
          <button id="mode-auto" class="active">Auto</button>
          <button id="mode-manual">Manuel</button>
        </div>
      </div>

      <div class="control-section">
        <div class="control-label">Volume</div>
        <input type="range" min="0" max="100" value="70"
               class="volume-slider" id="volume-slider">
      </div>

      <div class="control-section key-hints-compact">
        <span><kbd>W</kbd>/<kbd>S</kbd> Gaz/Frein</span>
        <span><kbd>A</kbd>/<kbd>D</kbd> Rapports</span>
      </div>
    `,this.powerBtn=document.getElementById("power-btn"),this.powerBtn.addEventListener("click",()=>{this._isEngineOn=!this._isEngineOn,this.powerBtn.classList.toggle("on",this._isEngineOn),this.powerCallback?.(this._isEngineOn)}),this.throttleSlider=document.getElementById("throttle-slider"),this.brakeSlider=document.getElementById("brake-slider"),this.throttleValEl=document.getElementById("throttle-val"),this.brakeValEl=document.getElementById("brake-val"),this.gearNumberEl=document.getElementById("gear-number"),this.autoBtn=document.getElementById("mode-auto"),this.manualBtn=document.getElementById("mode-manual"),document.getElementById("gear-down").addEventListener("click",()=>{this._shiftDownPressed=!0}),document.getElementById("gear-up").addEventListener("click",()=>{this._shiftUpPressed=!0}),this.autoBtn.addEventListener("click",()=>{this._transmissionMode="automatic",this.autoBtn.classList.add("active"),this.manualBtn.classList.remove("active")}),this.manualBtn.addEventListener("click",()=>{this._transmissionMode="manual",this.manualBtn.classList.add("active"),this.autoBtn.classList.remove("active")});const e=document.getElementById("volume-slider");e.addEventListener("input",()=>{this.volumeCallback?.(parseFloat(e.value)/100)})}setupKeyboard(){window.addEventListener("keydown",e=>{const i=e.key.toLowerCase();this.keysDown.add(i),(i==="a"||i==="arrowleft")&&(this._shiftDownPressed=!0),(i==="d"||i==="arrowright")&&(this._shiftUpPressed=!0)}),window.addEventListener("keyup",e=>{this.keysDown.delete(e.key.toLowerCase())})}}const he=2*Math.PI;function N(p,e,i){const s=p.gearRatios[i];return e*he*p.wheelRadius/(s*p.finalDrive*60)*3.6}function H(p){return p.torqueCurve.map(([e,i])=>({rpm:e,kw:K(i,e).kw}))}function Q(p){return p.torqueCurve.map(([e,i])=>({rpm:e,nm:i}))}function de(p){const e=Math.max(100,Math.floor((p.redlineRPM-p.idleRPM)/50)),i=[];for(let s=0;s<p.gearRatios.length;s++){const a=[];for(let t=p.idleRPM;t<=p.redlineRPM;t+=e)a.push({rpm:t,kmh:N(p,t,s)});a.length>0&&a[a.length-1].rpm<p.redlineRPM&&a.push({rpm:p.redlineRPM,kmh:N(p,p.redlineRPM,s)}),i.push({gear:s+1,points:a})}return i}const b={power:"#22c55e",torque:"#e94560",grid:"#1e293b",text:"#556",bg:"rgba(15, 21, 41, 0.6)",stroke:"#2a2a4a"},A=["#22c55e","#3b82f6","#eab308","#e94560","#a855f7","#06b6d4","#f97316","#ec4899"],F=["power","torque","power-torque","speed-gears"],U={power:"Puissance",torque:"Couple","power-torque":"P + C","speed-gears":"Vitesse / rapports"};class pe{profile;kind="power";canvas;ctx;resizeObserver=null;labelEl;constructor(e,i,s){this.profile=i,this.labelEl=s??null,this.labelEl&&(this.labelEl.textContent=U[this.kind]),this.canvas=document.createElement("canvas"),this.canvas.className="detail-chart-canvas",this.canvas.title="Cliquer pour changer de courbe",this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("click",()=>{const a=F.indexOf(this.kind),t=F[(a+1)%F.length];this.setChartKind(t)}),e.appendChild(this.canvas),this.resizeObserver=new ResizeObserver(()=>this.resizeAndDraw()),this.resizeObserver.observe(this.canvas.parentElement),this.resizeAndDraw()}setProfile(e){this.profile=e,this.resizeAndDraw()}setChartKind(e){this.kind!==e&&(this.kind=e,this.labelEl&&(this.labelEl.textContent=U[e]),this.draw())}destroy(){this.resizeObserver?.disconnect(),this.canvas.remove()}resizeAndDraw(){const e=this.canvas.parentElement.getBoundingClientRect(),i=Math.max(200,Math.min(e.width,500)),s=88,a=window.devicePixelRatio||1;this.canvas.width=i*a,this.canvas.height=s*a,this.canvas.style.width=`${i}px`,this.canvas.style.height=`${s}px`,this.draw()}draw(){const e=this.ctx,i=this.canvas.width/(window.devicePixelRatio||1),s=this.canvas.height/(window.devicePixelRatio||1),a=window.devicePixelRatio||1;e.setTransform(a,0,0,a,0,0),e.clearRect(0,0,i,s);const t={top:8,right:8,bottom:20,left:36},r=i-t.left-t.right,l=s-t.top-t.bottom;if(r<10||l<10)return;e.fillStyle=b.bg,e.strokeStyle=b.stroke,e.lineWidth=1,e.beginPath(),e.roundRect(0,0,i,s,6),e.fill(),e.stroke();const{idleRPM:c,redlineRPM:n}=this.profile,o=c,d=n,h=d-o,u=f=>t.left+(f-o)/h*r;e.font="9px system-ui",e.textAlign="center",e.textBaseline="top";const w=h<=4e3?1e3:2e3;for(let f=Math.ceil(o/w)*w;f<=d;f+=w){const v=u(f);e.strokeStyle=b.grid,e.beginPath(),e.moveTo(v,t.top),e.lineTo(v,t.top+l),e.stroke(),e.fillStyle=b.text,e.fillText(`${f/1e3}k`,v,t.top+l+3)}this.kind==="power"?this.drawPowerCurve(t,r,l,u):this.kind==="torque"?this.drawTorqueCurve(t,r,l,u):this.kind==="power-torque"?this.drawPowerTorqueCurve(t,r,l,u):this.drawSpeedGearCurves(t,r,l,u)}drawPowerCurve(e,i,s,a){const t=H(this.profile);if(t.length<2)return;const r=Math.max(...t.map(n=>n.kw),this.profile.peakPower*1.05),l=n=>e.top+s-n/r*s;this.ctx.textAlign="right",this.ctx.textBaseline="middle";const c=r<=150?50:100;for(let n=0;n<=r;n+=c){const o=l(n);this.ctx.strokeStyle=b.grid,this.ctx.beginPath(),this.ctx.moveTo(e.left,o),this.ctx.lineTo(e.left+i,o),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.fillText(String(n),e.left-4,o)}this.ctx.beginPath(),this.ctx.strokeStyle=b.power,this.ctx.lineWidth=2,this.ctx.lineJoin="round",t.forEach((n,o)=>{o===0?this.ctx.moveTo(a(n.rpm),l(n.kw)):this.ctx.lineTo(a(n.rpm),l(n.kw))}),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.textAlign="left",this.ctx.fillText("kW",e.left+i+2,e.top+8)}drawTorqueCurve(e,i,s,a){const t=Q(this.profile);if(t.length<2)return;const r=Math.max(...t.map(n=>n.nm),this.profile.peakTorque*1.05),l=n=>e.top+s-n/r*s;this.ctx.textAlign="right",this.ctx.textBaseline="middle";const c=r<=300?100:150;for(let n=0;n<=r;n+=c){const o=l(n);this.ctx.strokeStyle=b.grid,this.ctx.beginPath(),this.ctx.moveTo(e.left,o),this.ctx.lineTo(e.left+i,o),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.fillText(String(n),e.left-4,o)}this.ctx.beginPath(),this.ctx.strokeStyle=b.torque,this.ctx.lineWidth=2,this.ctx.lineJoin="round",t.forEach((n,o)=>{o===0?this.ctx.moveTo(a(n.rpm),l(n.nm)):this.ctx.lineTo(a(n.rpm),l(n.nm))}),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.textAlign="left",this.ctx.fillText("Nm",e.left+i+2,e.top+8)}drawPowerTorqueCurve(e,i,s,a){const t=H(this.profile),r=Q(this.profile);if(t.length<2||r.length<2)return;const l=Math.max(...t.map(h=>h.kw),this.profile.peakPower*1.05),c=Math.max(...r.map(h=>h.nm),this.profile.peakTorque*1.05),n=h=>e.top+s-h/l*s,o=h=>e.top+s-h/c*s;this.ctx.textAlign="right",this.ctx.textBaseline="middle";const d=l<=150?50:100;for(let h=0;h<=l;h+=d){const u=n(h);this.ctx.strokeStyle=b.grid,this.ctx.beginPath(),this.ctx.moveTo(e.left,u),this.ctx.lineTo(e.left+i,u),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.fillText(String(h),e.left-4,u)}this.ctx.beginPath(),this.ctx.strokeStyle=b.power,this.ctx.lineWidth=2,this.ctx.lineJoin="round",t.forEach((h,u)=>{u===0?this.ctx.moveTo(a(h.rpm),n(h.kw)):this.ctx.lineTo(a(h.rpm),n(h.kw))}),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=b.torque,this.ctx.setLineDash([4,3]),r.forEach((h,u)=>{u===0?this.ctx.moveTo(a(h.rpm),o(h.nm)):this.ctx.lineTo(a(h.rpm),o(h.nm))}),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.font="9px system-ui",this.ctx.fillStyle=b.power,this.ctx.textAlign="left",this.ctx.fillText("kW",e.left+i+2,e.top+6),this.ctx.fillStyle=b.torque,this.ctx.fillText("Nm",e.left+i+2,e.top+16)}drawSpeedGearCurves(e,i,s,a){const t=de(this.profile);let r=0;t.forEach(n=>{n.points.forEach(o=>{o.kmh>r&&(r=o.kmh)})}),r=Math.ceil(r/20)*20||100;const l=n=>e.top+s-n/r*s;this.ctx.textAlign="right",this.ctx.textBaseline="middle";const c=r<=150?50:100;for(let n=0;n<=r;n+=c){const o=l(n);this.ctx.strokeStyle=b.grid,this.ctx.beginPath(),this.ctx.moveTo(e.left,o),this.ctx.lineTo(e.left+i,o),this.ctx.stroke(),this.ctx.fillStyle=b.text,this.ctx.fillText(String(n),e.left-4,o)}t.forEach(({points:n},o)=>{const d=A[o%A.length];this.ctx.beginPath(),this.ctx.strokeStyle=d,this.ctx.lineWidth=1.5,this.ctx.lineJoin="round",n.forEach((h,u)=>{u===0?this.ctx.moveTo(a(h.rpm),l(h.kmh)):this.ctx.lineTo(a(h.rpm),l(h.kmh))}),this.ctx.stroke()}),this.ctx.font="8px system-ui",this.ctx.textAlign="left",t.forEach(({gear:n},o)=>{const d=A[o%A.length];this.ctx.fillStyle=d,this.ctx.fillText(`${n}`,e.left+i+2,e.top+6+o*10)})}}class ue{container;groups;activeId;activeProfile;onSelect;viewMode="carousel";isCompact=!1;detailCharts=null;constructor(e,i,s,a){this.container=document.getElementById(e),this.groups=i,this.activeId=s.id,this.activeProfile=s,this.onSelect=a,this.render()}setCompact(e){this.isCompact!==e&&(this.isCompact=e,this.render())}render(){this.detailCharts?.destroy(),this.detailCharts=null,this.container.innerHTML="",this.container.className=this.isCompact?"vehicle-gallery compact":"vehicle-gallery",this.viewMode==="carousel"?this.renderCarousel():this.renderDetail()}renderCarousel(){const e=document.createElement("div");e.className=this.isCompact?"gallery-carousel compact":"gallery-carousel";for(const i of this.groups)for(const s of i.profiles){const a=document.createElement("div");if(a.className=s.id===this.activeId?"vehicle-card active":"vehicle-card",this.isCompact)a.innerHTML=`
            <img src="${s.imageUrl||""}" alt="${s.name}" loading="lazy" />
            <span class="vehicle-card-name-compact">${s.name.split(" ")[0]}</span>
          `;else{const r=s.peakPower,l=s.peakTorque;a.innerHTML=`
            <img src="${s.imageUrl||""}" alt="${s.name}" loading="lazy" />
            <div class="vehicle-card-info">
              <div class="vehicle-card-name">${s.name}</div>
              <div class="vehicle-card-stats">${r} kW · ${l} Nm · ${s.displacement}cc</div>
            </div>
          `}a.querySelector("img")?.addEventListener("click",r=>{r.stopPropagation(),s.id!==this.activeId&&(this.activeId=s.id,this.activeProfile=s,this.onSelect(s)),this.viewMode="detail",this.render()}),a.addEventListener("click",r=>{r.target.closest("img")||s.id!==this.activeId&&(this.activeId=s.id,this.activeProfile=s,this.onSelect(s),this.render())}),e.appendChild(a)}this.container.appendChild(e)}renderDetail(){const e=this.activeProfile,i=document.createElement("div");i.className="vehicle-detail-panel";const s=e.gearRatios.length,a=e.aspiration==="turbo"?"Turbo":e.aspiration==="turbo-diesel"?"Turbo Diesel":"Atmosphérique",t=e.driveType==="fwd"?"Traction avant":e.driveType==="awd"?"Intégrale":e.driveType==="rwd"?"Traction arrière":"—";i.innerHTML=`
      <div class="detail-content">
        <div class="detail-photo" role="button" tabindex="0" aria-label="Retour à la galerie">
          <img src="${e.imageUrl||""}" alt="${e.name}" />
        </div>
        <div class="detail-right mode-specs">
          <div class="detail-header">
            <h3 class="detail-title">${e.name}</h3>
            <div class="detail-toggle">
              <button type="button" class="detail-toggle-btn active" data-mode="specs">Fiche</button>
              <button type="button" class="detail-toggle-btn" data-mode="chart">Courbes</button>
            </div>
            <span class="detail-chart-name" aria-hidden="true"></span>
          </div>
          <div class="detail-body">
            <div class="detail-specs">
            <dl class="detail-grid">
              <dt>Type</dt><dd>${e.type}</dd>
              <dt>Cylindrée</dt><dd>${e.displacement} cc</dd>
              <dt>Cylindres</dt><dd>${e.cylinders}</dd>
              <dt>Aspiration</dt><dd>${a}</dd>
              <dt>Traction</dt><dd>${t}</dd>
              <dt>Puissance</dt><dd>${e.peakPower} kW @ ${e.peakPowerRPM}</dd>
              <dt>Couple</dt><dd>${e.peakTorque} Nm @ ${e.peakTorqueRPM}</dd>
              <dt>Redline</dt><dd>${e.redlineRPM} RPM</dd>
              <dt>Vitesses</dt><dd>${s}</dd>
              <dt>Masse</dt><dd>${e.vehicleMass} kg</dd>
              <dt>P/M</dt><dd>${(e.peakPower/e.vehicleMass*1e3).toFixed(1)} W/kg</dd>
            </dl>
            </div>
            <div class="detail-chart-wrap"></div>
          </div>
        </div>
      </div>
    `;const r=i.querySelector(".detail-photo");r?.addEventListener("click",()=>{this.viewMode="carousel",this.render()}),r?.addEventListener("keydown",d=>{const h=d;(h.key==="Enter"||h.key===" ")&&(d.preventDefault(),this.viewMode="carousel",this.render())});const l=i.querySelector(".detail-right"),c=i.querySelectorAll(".detail-toggle-btn");l&&c.length&&c.forEach(d=>{d.addEventListener("click",()=>{const h=d.dataset.mode==="chart"?"chart":"specs";l.classList.toggle("mode-specs",h==="specs"),l.classList.toggle("mode-chart",h==="chart"),c.forEach(u=>u.classList.toggle("active",u===d))})});const n=i.querySelector(".detail-chart-wrap"),o=i.querySelector(".detail-chart-name");n&&(this.detailCharts=new pe(n,this.activeProfile,o)),this.container.appendChild(i)}}const me="honda-k20a",fe="Honda K20A VTEC",ge="https://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Honda_FK8.jpg/300px-Honda_FK8.jpg",ve="inline-4",we=1998,be=4,Me="na",Re="fwd",xe=800,Pe=8600,Te=206,ye=7e3,$e=162,ke=8e3,Se=[[800,50],[1e3,90],[2e3,130],[3e3,155],[4e3,175],[5e3,190],[5500,185],[6e3,180],[6500,190],[7e3,206],[7500,200],[8e3,188],[8600,160]],Be=[1,3,4,2],Ce=[3.267,2.105,1.481,1.161,.971,.811],_e=4.764,qe=.316,Ae={type:"sport",lowpassBaseFreq:1500,lowpassRpmScale:.3,lowpassQ:1.5,resonances:[{freq:600,Q:5,gainDB:8},{freq:1800,Q:3,gainDB:4},{freq:3500,Q:2,gainDB:3}]},De={numHarmonics:24,spectralRolloff:.9,firingHarmonicBoost:3,loadBrightness:.7},Ee=1200,Ge=.31,Oe=2,Fe=.012,Ie={id:me,name:fe,imageUrl:ge,type:ve,displacement:we,cylinders:be,aspiration:Me,driveType:Re,idleRPM:xe,redlineRPM:Pe,peakTorque:Te,peakTorqueRPM:ye,peakPower:$e,peakPowerRPM:ke,torqueCurve:Se,firingOrder:Be,gearRatios:Ce,finalDrive:_e,wheelRadius:qe,exhaustConfig:Ae,harmonicProfile:De,vehicleMass:Ee,dragCoefficient:Ge,frontalArea:Oe,rollingResistance:Fe},Le="toyota-2gr-fe",Ve="Toyota 2GR-FE V6",Ne="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/2021_Toyota_Camry_TRD_V6.jpg/300px-2021_Toyota_Camry_TRD_V6.jpg",He="v6",Qe=3456,Ue=6,Ke="na",We="fwd",ze=650,je=6500,Je=336,Ye=4700,Xe=200,Ze=6200,et=[[650,80],[1e3,150],[1500,220],[2e3,270],[2500,300],[3e3,320],[3500,330],[4e3,334],[4700,336],[5e3,330],[5500,310],[6e3,280],[6500,240]],tt=[1,2,3,4,5,6],it=[3.52,2.042,1.4,1,.716,.586],st=3.933,at=.33,ot={type:"stock",lowpassBaseFreq:900,lowpassRpmScale:.15,lowpassQ:.8,resonances:[{freq:450,Q:3,gainDB:5},{freq:1300,Q:2,gainDB:3}]},nt={numHarmonics:24,spectralRolloff:1,firingHarmonicBoost:3.5,loadBrightness:.6},rt=1600,lt=.3,ct=2.3,ht=.012,dt={id:Le,name:Ve,imageUrl:Ne,type:He,displacement:Qe,cylinders:Ue,aspiration:Ke,driveType:We,idleRPM:ze,redlineRPM:je,peakTorque:Je,peakTorqueRPM:Ye,peakPower:Xe,peakPowerRPM:Ze,torqueCurve:et,firingOrder:tt,gearRatios:it,finalDrive:st,wheelRadius:at,exhaustConfig:ot,harmonicProfile:nt,vehicleMass:rt,dragCoefficient:lt,frontalArea:ct,rollingResistance:ht},pt="ford-coyote-50",ut="Ford Coyote 5.0 V8",mt="https://upload.wikimedia.org/wikipedia/commons/thumb/5/5d/2018_Ford_Mustang_GT_5.0_Front.jpg/300px-2018_Ford_Mustang_GT_5.0_Front.jpg",ft="v8-crossplane",gt=5035,vt=8,wt="na",bt="rwd",Mt=700,Rt=7500,xt=569,Pt=4600,Tt=343,yt=7e3,$t=[[700,100],[1e3,200],[1500,320],[2e3,400],[2500,460],[3e3,510],[3500,545],[4e3,560],[4600,569],[5e3,560],[5500,540],[6e3,510],[6500,470],[7e3,420],[7500,360]],kt=[1,3,7,2,6,5,4,8],St=[3.657,2.18,1.452,1,.686,.58],Bt=3.73,Ct=.34,_t={type:"sport",lowpassBaseFreq:1800,lowpassRpmScale:.35,lowpassQ:1.2,resonances:[{freq:350,Q:6,gainDB:10},{freq:800,Q:4,gainDB:6},{freq:2200,Q:2,gainDB:3}]},qt={numHarmonics:24,spectralRolloff:.8,firingHarmonicBoost:2.5,loadBrightness:.8},At=1700,Dt=.33,Et=2.2,Gt=.013,Ot={id:pt,name:ut,imageUrl:mt,type:ft,displacement:gt,cylinders:vt,aspiration:wt,driveType:bt,idleRPM:Mt,redlineRPM:Rt,peakTorque:xt,peakTorqueRPM:Pt,peakPower:Tt,peakPowerRPM:yt,torqueCurve:$t,firingOrder:kt,gearRatios:St,finalDrive:Bt,wheelRadius:Ct,exhaustConfig:_t,harmonicProfile:qt,vehicleMass:At,dragCoefficient:Dt,frontalArea:Et,rollingResistance:Gt},Ft="bmw-b58",It="BMW B58 Turbo I6",Lt="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/BMW_M340i_%28G20%29_Washington_DC_Metro_Area%2C_USA.jpg/300px-BMW_M340i_%28G20%29_Washington_DC_Metro_Area%2C_USA.jpg",Vt="inline-6",Nt=2998,Ht=6,Qt="turbo",Ut="rwd",Kt=700,Wt=7e3,zt=500,jt=1600,Jt=285,Yt=5500,Xt=[[700,100],[1e3,250],[1200,350],[1400,430],[1600,500],[2e3,500],[2500,500],[3e3,500],[3500,500],[4e3,500],[4500,500],[5e3,480],[5500,440],[6e3,390],[6500,350],[7e3,300]],Zt=[1,5,3,6,2,4],ei=[4.714,3.143,2.106,1.667,1.285,1,.839,.667],ti=3.154,ii=.33,si={type:"sport",lowpassBaseFreq:1400,lowpassRpmScale:.25,lowpassQ:1.3,resonances:[{freq:500,Q:5,gainDB:7},{freq:1500,Q:3,gainDB:5},{freq:3e3,Q:2,gainDB:3}]},ai={numHarmonics:24,spectralRolloff:1,firingHarmonicBoost:3.5,loadBrightness:.65},oi={maxBoostBar:1.2,spoolTimeSec:.5,boostThresholdRPM:1500,hasBOV:!0},ni=1600,ri=.29,li=2.2,ci=.011,hi={id:Ft,name:It,imageUrl:Lt,type:Vt,displacement:Nt,cylinders:Ht,aspiration:Qt,driveType:Ut,idleRPM:Kt,redlineRPM:Wt,peakTorque:zt,peakTorqueRPM:jt,peakPower:Jt,peakPowerRPM:Yt,torqueCurve:Xt,firingOrder:Zt,gearRatios:ei,finalDrive:ti,wheelRadius:ii,exhaustConfig:si,harmonicProfile:ai,turbo:oi,vehicleMass:ni,dragCoefficient:ri,frontalArea:li,rollingResistance:ci},di="ferrari-f136",pi="Ferrari F136 V8",ui="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/White_Ferrari_458_Italia_front.JPG/300px-White_Ferrari_458_Italia_front.JPG",mi="v8-flatplane",fi=4497,gi=8,vi="na",wi="rwd",bi=1e3,Mi=9e3,Ri=540,xi=6e3,Pi=419,Ti=9e3,yi=[[1e3,100],[1500,180],[2e3,260],[2500,320],[3e3,380],[3500,420],[4e3,450],[4500,475],[5e3,500],[5500,525],[6e3,540],[6500,535],[7e3,520],[7500,495],[8e3,465],[8500,430],[9e3,390]],$i=[1,8,2,7,4,5,3,6],ki=[3.08,2.19,1.63,1.29,1.03,.84,.64],Si=4.44,Bi=.33,Ci={type:"straight-pipe",lowpassBaseFreq:3500,lowpassRpmScale:.4,lowpassQ:.7,resonances:[{freq:400,Q:7,gainDB:9},{freq:1100,Q:5,gainDB:6},{freq:3200,Q:3,gainDB:4}]},_i={numHarmonics:28,spectralRolloff:.85,firingHarmonicBoost:3.5,loadBrightness:.75},qi=1485,Ai=.33,Di=2,Ei=.011,Gi={id:di,name:pi,imageUrl:ui,type:mi,displacement:fi,cylinders:gi,aspiration:vi,driveType:wi,idleRPM:bi,redlineRPM:Mi,peakTorque:Ri,peakTorqueRPM:xi,peakPower:Pi,peakPowerRPM:Ti,torqueCurve:yi,firingOrder:$i,gearRatios:ki,finalDrive:Si,wheelRadius:Bi,exhaustConfig:Ci,harmonicProfile:_i,vehicleMass:qi,dragCoefficient:Ai,frontalArea:Di,rollingResistance:Ei},Oi="vw-20-tdi",Fi="VW 2.0 TDI Diesel",Ii="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/VW_Golf_VII_Variant_Highline_2.0_TDI.JPG/300px-VW_Golf_VII_Variant_Highline_2.0_TDI.JPG",Li="inline-4",Vi=1968,Ni=4,Hi="turbo-diesel",Qi="fwd",Ui=800,Ki=5e3,Wi=320,zi=1750,ji=103,Ji=4e3,Yi=[[800,80],[1e3,150],[1200,220],[1500,280],[1750,320],[2e3,320],[2500,320],[3e3,290],[3500,250],[4e3,210],[4500,170],[5e3,120]],Xi=[1,3,4,2],Zi=[3.778,2.118,1.36,.971,.756,.635],es=3.45,ts=.32,is={type:"stock",lowpassBaseFreq:700,lowpassRpmScale:.12,lowpassQ:.6,resonances:[{freq:300,Q:3,gainDB:4},{freq:900,Q:2,gainDB:2}]},ss={numHarmonics:20,spectralRolloff:1.2,firingHarmonicBoost:2.5,loadBrightness:.5},as={maxBoostBar:1.8,spoolTimeSec:.8,boostThresholdRPM:1200,hasBOV:!1},os=1450,ns=.3,rs=2.2,ls=.012,cs={id:Oi,name:Fi,imageUrl:Ii,type:Li,displacement:Vi,cylinders:Ni,aspiration:Hi,driveType:Qi,idleRPM:Ui,redlineRPM:Ki,peakTorque:Wi,peakTorqueRPM:zi,peakPower:ji,peakPowerRPM:Ji,torqueCurve:Yi,firingOrder:Xi,gearRatios:Zi,finalDrive:es,wheelRadius:ts,exhaustConfig:is,harmonicProfile:ss,turbo:as,vehicleMass:os,dragCoefficient:ns,frontalArea:rs,rollingResistance:ls},hs="bugatti-chiron",ds="Bugatti Chiron W16",ps="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Bugatti_Chiron%2C_GIMS_2018%2C_Le_Grand-Saconnex_%281X7A1765%29.jpg/300px-Bugatti_Chiron%2C_GIMS_2018%2C_Le_Grand-Saconnex_%281X7A1765%29.jpg",us="w16",ms=7993,fs=16,gs="turbo",vs="awd",ws=700,bs=6900,Ms=1600,Rs=2e3,xs=1103,Ps=6700,Ts=[[700,300],[1e3,600],[1500,1200],[2e3,1600],[2500,1600],[3e3,1600],[3500,1600],[4e3,1600],[4500,1550],[5e3,1500],[5500,1400],[6e3,1300],[6500,1200],[6900,1100]],ys=[1,12,7,4,15,6,13,8,3,16,11,2,9,14,5,10],$s=[3.846,2.476,1.786,1.391,1.121,.943,.794],ks=2.235,Ss=.36,Bs={type:"sport",lowpassBaseFreq:1600,lowpassRpmScale:.3,lowpassQ:1,resonances:[{freq:400,Q:4,gainDB:8},{freq:1200,Q:3,gainDB:5},{freq:2800,Q:2,gainDB:3}]},Cs={numHarmonics:28,spectralRolloff:1.1,firingHarmonicBoost:2,loadBrightness:.6},_s={maxBoostBar:1.6,spoolTimeSec:.6,boostThresholdRPM:1500,hasBOV:!0},qs=1995,As=.35,Ds=2.07,Es=.01,Gs={id:hs,name:ds,imageUrl:ps,type:us,displacement:ms,cylinders:fs,aspiration:gs,driveType:vs,idleRPM:ws,redlineRPM:bs,peakTorque:Ms,peakTorqueRPM:Rs,peakPower:xs,peakPowerRPM:Ps,torqueCurve:Ts,firingOrder:ys,gearRatios:$s,finalDrive:ks,wheelRadius:Ss,exhaustConfig:Bs,harmonicProfile:Cs,turbo:_s,vehicleMass:qs,dragCoefficient:As,frontalArea:Ds,rollingResistance:Es},Os="lamborghini-aventador",Fs="Lamborghini Aventador V12",Is="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Lamborghini_Aventador_LP700-4.jpg/300px-Lamborghini_Aventador_LP700-4.jpg",Ls="v12",Vs=6498,Ns=12,Hs="na",Qs="awd",Us=800,Ks=8500,Ws=690,zs=5500,js=566,Js=8250,Ys=[[800,200],[1500,350],[2500,450],[3500,550],[4500,620],[5500,690],[6e3,680],[6500,660],[7e3,640],[7500,610],[8e3,570],[8500,520]],Xs=[1,7,5,11,3,9,6,12,2,8,4,10],Zs=[3.91,2.56,1.81,1.39,1.08,.88,.73],ea=3.21,ta=.35,ia={type:"straight-pipe",lowpassBaseFreq:3200,lowpassRpmScale:.4,lowpassQ:.8,resonances:[{freq:450,Q:6,gainDB:9},{freq:1100,Q:4,gainDB:6},{freq:2800,Q:3,gainDB:4}]},sa={numHarmonics:28,spectralRolloff:.85,firingHarmonicBoost:3,loadBrightness:.7},aa=1575,oa=.33,na=2.12,ra=.01,la={id:Os,name:Fs,imageUrl:Is,type:Ls,displacement:Vs,cylinders:Ns,aspiration:Hs,driveType:Qs,idleRPM:Us,redlineRPM:Ks,peakTorque:Ws,peakTorqueRPM:zs,peakPower:js,peakPowerRPM:Js,torqueCurve:Ys,firingOrder:Xs,gearRatios:Zs,finalDrive:ea,wheelRadius:ta,exhaustConfig:ia,harmonicProfile:sa,vehicleMass:aa,dragCoefficient:oa,frontalArea:na,rollingResistance:ra},ca="porsche-911-gt3",ha="Porsche 911 GT3 Flat-6",da="https://upload.wikimedia.org/wikipedia/commons/thumb/1/18/Porsche_911_GT3_4.0_%28992%29_1X7A7256.jpg/300px-Porsche_911_GT3_4.0_%28992%29_1X7A7256.jpg",pa="flat-6",ua=3996,ma=6,fa="na",ga="rwd",va=900,wa=9e3,ba=470,Ma=6100,Ra=375,xa=8400,Pa=[[900,140],[1500,220],[2500,310],[3500,380],[4500,430],[5e3,450],[5500,460],[6100,470],[6500,465],[7e3,455],[7500,440],[8e3,420],[8400,400],[9e3,370]],Ta=[1,6,2,4,3,5],ya=[3.31,2.16,1.61,1.27,1.03,.85,.71],$a=3.44,ka=.33,Sa={type:"sport",lowpassBaseFreq:2800,lowpassRpmScale:.5,lowpassQ:.9,resonances:[{freq:500,Q:5,gainDB:8},{freq:1400,Q:4,gainDB:5},{freq:3500,Q:2,gainDB:3}]},Ba={numHarmonics:26,spectralRolloff:.85,firingHarmonicBoost:3.5,loadBrightness:.75},Ca=1418,_a=.34,qa=2,Aa=.01,Da={id:ca,name:ha,imageUrl:da,type:pa,displacement:ua,cylinders:ma,aspiration:fa,driveType:ga,idleRPM:va,redlineRPM:wa,peakTorque:ba,peakTorqueRPM:Ma,peakPower:Ra,peakPowerRPM:xa,torqueCurve:Pa,firingOrder:Ta,gearRatios:ya,finalDrive:$a,wheelRadius:ka,exhaustConfig:Sa,harmonicProfile:Ba,vehicleMass:Ca,dragCoefficient:_a,frontalArea:qa,rollingResistance:Aa},Ea="ducati-panigale-v4",Ga="Ducati Panigale V4",Oa="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/Ducati_Panigale_V4_Las_Vegas.jpg/300px-Ducati_Panigale_V4_Las_Vegas.jpg",Fa="v4",Ia=1103,La=4,Va="na",Na="rwd",Ha=1200,Qa=14500,Ua=124,Ka=1e4,Wa=157,za=13e3,ja=[[1200,35],[2e3,50],[3e3,65],[4e3,78],[5e3,88],[6e3,97],[7e3,105],[8e3,112],[9e3,119],[1e4,124],[11e3,122],[12e3,118],[13e3,112],[14e3,100],[14500,90]],Ja=[1,3,2,4],Ya=[2.93,2.15,1.76,1.52,1.36,1.24],Xa=2.93,Za=.31,eo={type:"sport",lowpassBaseFreq:2400,lowpassRpmScale:.6,lowpassQ:.8,resonances:[{freq:600,Q:5,gainDB:8},{freq:1600,Q:4,gainDB:5},{freq:4e3,Q:2,gainDB:3}]},to={numHarmonics:24,spectralRolloff:.8,firingHarmonicBoost:3,loadBrightness:.8},io=198,so=.6,ao=.55,oo=.012,no={id:Ea,name:Ga,imageUrl:Oa,type:Fa,displacement:Ia,cylinders:La,aspiration:Va,driveType:Na,idleRPM:Ha,redlineRPM:Qa,peakTorque:Ua,peakTorqueRPM:Ka,peakPower:Wa,peakPowerRPM:za,torqueCurve:ja,firingOrder:Ja,gearRatios:Ya,finalDrive:Xa,wheelRadius:Za,exhaustConfig:eo,harmonicProfile:to,vehicleMass:io,dragCoefficient:so,frontalArea:ao,rollingResistance:oo},ro="yamaha-r1",lo="Yamaha YZF-R1",co="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/2015_Yamaha_YZF-R1.JPG/300px-2015_Yamaha_YZF-R1.JPG",ho="inline-4",po=998,uo=4,mo="na",fo="rwd",go=1100,vo=13500,wo=113,bo=11500,Mo=147,Ro=13e3,xo=[[1100,30],[2e3,42],[3e3,55],[4e3,65],[5e3,75],[6e3,83],[7e3,90],[8e3,96],[9e3,102],[1e4,107],[11e3,111],[11500,113],[12e3,110],[13e3,105],[13500,95]],Po=[1,3,2,4],To=[2.85,2.06,1.69,1.45,1.29,1.16],yo=2.82,$o=.31,ko={type:"sport",lowpassBaseFreq:2200,lowpassRpmScale:.55,lowpassQ:.8,resonances:[{freq:550,Q:5,gainDB:7},{freq:1500,Q:3,gainDB:5},{freq:3800,Q:2,gainDB:3}]},So={numHarmonics:24,spectralRolloff:.85,firingHarmonicBoost:3,loadBrightness:.75},Bo=201,Co=.58,_o=.55,qo=.012,Ao={id:ro,name:lo,imageUrl:co,type:ho,displacement:po,cylinders:uo,aspiration:mo,driveType:fo,idleRPM:go,redlineRPM:vo,peakTorque:wo,peakTorqueRPM:bo,peakPower:Mo,peakPowerRPM:Ro,torqueCurve:xo,firingOrder:Po,gearRatios:To,finalDrive:yo,wheelRadius:$o,exhaustConfig:ko,harmonicProfile:So,vehicleMass:Bo,dragCoefficient:Co,frontalArea:_o,rollingResistance:qo},Do="harley-davidson-vtwin",Eo="Harley-Davidson V-Twin",Go="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/Harley_Davidson_Fat_Boy_2018_FLFBS.jpg/300px-Harley_Davidson_Fat_Boy_2018_FLFBS.jpg",Oo="v-twin",Fo=1868,Io=2,Lo="na",Vo="rwd",No=800,Ho=5500,Qo=150,Uo=3e3,Ko=65,Wo=4800,zo=[[800,50],[1e3,70],[1500,100],[2e3,125],[2500,140],[3e3,150],[3500,148],[4e3,142],[4500,132],[4800,120],[5e3,110],[5500,95]],jo=[1,2],Jo=[3.36,2.3,1.65,1.29,1,.84],Yo=2.41,Xo=.33,Zo={type:"straight-pipe",lowpassBaseFreq:1200,lowpassRpmScale:.35,lowpassQ:.7,resonances:[{freq:250,Q:4,gainDB:10},{freq:700,Q:3,gainDB:6},{freq:1500,Q:2,gainDB:3}]},en={numHarmonics:20,spectralRolloff:.7,firingHarmonicBoost:4,loadBrightness:.6},tn=320,sn=.65,an=.7,on=.013,nn={id:Do,name:Eo,imageUrl:Go,type:Oo,displacement:Fo,cylinders:Io,aspiration:Lo,driveType:Vo,idleRPM:No,redlineRPM:Ho,peakTorque:Qo,peakTorqueRPM:Uo,peakPower:Ko,peakPowerRPM:Wo,torqueCurve:zo,firingOrder:jo,gearRatios:Jo,finalDrive:Yo,wheelRadius:Xo,exhaustConfig:Zo,harmonicProfile:en,vehicleMass:tn,dragCoefficient:sn,frontalArea:an,rollingResistance:on},W=[{label:"Cars",profiles:[Ie,dt,Ot,hi,Gi,cs]},{label:"Supercars",profiles:[Gs,la,Da]},{label:"Motos",profiles:[no,Ao,nn]}];function rn(){return W}function ln(){return W[0].profiles[0]}class cn{profile;transmission;vehicleDynamics;turboModel=null;audioEngine;dashboard;controls;state;isRunning=!1;lastTimestamp=0;animFrameId=0;revLimiterPhase=0;startupBlipTimer=0;prevThrottle=0;launchControlActive=!1;launchPhaseTimer=0;gallery;constructor(){this.profile=ln(),this.transmission=new D(this.profile),this.vehicleDynamics=new L(this.profile),this.profile.turbo&&(this.turboModel=new V(this.profile.turbo)),this.audioEngine=new re,this.dashboard=new le("tachometer-canvas","gauges",this.profile),this.controls=new ce("controls-container"),this.gallery=new ue("profile-selector-container",rn(),this.profile,e=>this.switchProfile(e)),this.state=this.createInitialState(),this.controls.onVolumeChange(e=>this.audioEngine.setVolume(e)),this.controls.onPowerChange(async e=>{e?await this.engineOn():this.engineOff()}),this.dashboard.render(this.state),this.controls.updateGearDisplay(0,!1)}async engineOn(){this.isRunning||(await this.audioEngine.initialize(this.profile),this.audioEngine.start(),await this.audioEngine.playStarterSound(),this.state=this.createInitialState(),this.revLimiterPhase=0,this.startupBlipTimer=.3,this.launchControlActive=!1,this.launchPhaseTimer=0,this.isRunning=!0,this.gallery.setCompact(!0),this.lastTimestamp=performance.now(),this.animFrameId=requestAnimationFrame(e=>this.loop(e)))}engineOff(){this.isRunning=!1,this.gallery.setCompact(!1),cancelAnimationFrame(this.animFrameId),this.state={...this.state,rpm:0,throttle:0,gear:0,speedMs:0,speedKmh:0,accelerationMs2:0,accelerationG:0,torqueNm:0,powerKw:0,powerHp:0,boostBar:0,revLimiterActive:!1,wheelSlip:0,launchControlActive:!1},this.dashboard.render(this.state),this.controls.updateGearDisplay(0,!1),this.audioEngine.stop(),this.vehicleDynamics.reset(),this.transmission.reset()}loop(e){if(!this.isRunning)return;const i=Math.min((e-this.lastTimestamp)/1e3,.05);this.lastTimestamp=e;const s=this.controls.update(i);if(this.startupBlipTimer>0){this.startupBlipTimer-=i;const m=Math.max(0,this.startupBlipTimer/.3);s.throttle=Math.max(s.throttle,.3*m)}this.transmission.update(i),this.transmission.mode=s.transmissionMode,s.shiftUpPressed&&(s.transmissionMode==="automatic"&&this.transmission.gear>0?this.transmission.manualOverrideShift("up",e):this.transmission.shiftUp(e)),s.shiftDownPressed&&(s.transmissionMode==="automatic"&&this.transmission.gear>0?this.transmission.manualOverrideShift("down",e):this.transmission.shiftDown(e,this.state.speedMs)),this.transmission.gear===1&&s.brake>.5&&s.throttle>.8&&this.state.speedMs<1?this.launchControlActive=!0:this.launchControlActive&&(s.brake<.1?(this.launchControlActive=!1,this.launchPhaseTimer=1.5):s.throttle<.3&&(this.launchControlActive=!1,this.launchPhaseTimer=0)),this.launchPhaseTimer>0&&(this.launchPhaseTimer=Math.max(0,this.launchPhaseTimer-i)),this.launchControlActive&&s.brake>.3&&this.vehicleDynamics.reset();const t=12,r=this.state.speedMs,l=this.transmission.gear,c=l>=1?this.transmission.speedToRPM(r,l):this.profile.idleRPM;let n=1,o;if(l===0)o=this.state.rpm;else if(this.launchControlActive)o=this.state.rpm,n=0;else if(r<t&&l>=1){const m=r/t;if(n=Math.min(1,m*m),this.launchPhaseTimer>0){const g=.2+.8*(1-this.launchPhaseTimer/1.5);n*=g}s.throttle<.05?(o=this.profile.idleRPM,n=0):(n=Math.max(.35*s.throttle,n),o=(this.profile.idleRPM+s.throttle*(this.profile.redlineRPM-this.profile.idleRPM)*.85)*(1-n)+c*n,o=Math.max(o,this.profile.idleRPM))}else o=Math.max(c,this.profile.idleRPM);const d=j(o,s.throttle,this.profile);let h=0,u=0;if(this.turboModel){const m=this.turboModel.update(o,s.throttle,i);h=m.boostBar,u=m.bovEnvelope,m.bovActive&&this.audioEngine.triggerBOV(u)}let w;if(this.profile.turbo&&this.turboModel){const m=h/this.profile.turbo.maxBoostBar;w=d*(.65+.35*m)}else w=d;const f=X(o,this.profile,this.revLimiterPhase,i);this.revLimiterPhase=f.newPhase,w*=f.torqueMultiplier,f.popTriggered&&this.audioEngine.triggerRevLimiterPop();const v=w;n===0&&(w=0);const{speedMs:R,accelerationMs2:T,wheelSlip:k}=this.vehicleDynamics.update(i,w,this.transmission.gear,s.brake,this.transmission.isShifting);let M;const S=this.transmission.speedToRPM(R,this.transmission.gear);if(l===0){let g=s.throttle>.05?this.profile.idleRPM+s.throttle*(this.profile.redlineRPM-this.profile.idleRPM)*1.05:this.profile.idleRPM;this.state.rpm>=this.profile.redlineRPM-100&&f.torqueMultiplier<.1&&(g=Math.min(g,this.profile.redlineRPM-200));const x=g>this.state.rpm?.15:.4;M=this.state.rpm+(g-this.state.rpm)*Math.min(1,i/x)}else if(this.launchControlActive){const m=Math.min(this.profile.peakPowerRPM*.7,this.profile.redlineRPM*.65);M=this.state.rpm+(m-this.state.rpm)*Math.min(1,i/.1)}else if(n<.99&&l>=1&&s.throttle>=.05){const m=R/t;let g=Math.min(1,m*m);if(this.launchPhaseTimer>0){const P=.2+.8*(1-this.launchPhaseTimer/1.5);g*=P}g=Math.max(.35*s.throttle,g),M=(this.profile.idleRPM+s.throttle*(this.profile.redlineRPM-this.profile.idleRPM)*.85)*(1-g)+S*g,M=Math.max(M,this.profile.idleRPM)}else l>=1?M=R<=0?this.profile.idleRPM:S:M=this.profile.idleRPM;l>=1&&R>0&&n>=.99?M=Math.max(0,Math.min(this.profile.redlineRPM,M)):M=J(M,this.profile),s.transmissionMode==="automatic"&&this.transmission.checkAutoShift(M,s.throttle,e);const $=this.launchControlActive?v:w,{kw:B,hp:G}=K($,M);this.state={rpm:M,throttle:s.throttle,brake:s.brake,gear:this.transmission.gear,speedMs:R,speedKmh:R*3.6,accelerationMs2:T,accelerationG:T/9.81,torqueNm:$,powerKw:B,powerHp:G,boostBar:h,isShifting:this.transmission.isShifting,transmissionMode:s.transmissionMode,revLimiterActive:f.torqueMultiplier<.5,wheelSlip:k,launchControlActive:this.launchControlActive},this.audioEngine.update(this.state),this.prevThrottle>.7&&s.throttle<.2&&M>this.profile.redlineRPM*.6&&this.audioEngine.triggerDecelCrackle(),this.prevThrottle=s.throttle,this.audioEngine.updateTireSqueal(k),this.dashboard.render(this.state),this.controls.updateGearDisplay(this.transmission.gear,this.transmission.isShifting),this.animFrameId=requestAnimationFrame(m=>this.loop(m))}async switchProfile(e){this.profile=e,this.transmission=new D(e),this.vehicleDynamics=new L(e),this.turboModel=e.turbo?new V(e.turbo):null,this.vehicleDynamics.reset(),this.revLimiterPhase=0,this.launchControlActive=!1,this.launchPhaseTimer=0,this.dashboard.setProfile(e),this.isRunning&&await this.audioEngine.switchProfile(e),this.state=this.createInitialState()}createInitialState(){return{rpm:this.isRunning?this.profile.idleRPM:0,throttle:0,brake:0,gear:0,speedMs:0,speedKmh:0,accelerationMs2:0,accelerationG:0,torqueNm:0,powerKw:0,powerHp:0,boostBar:0,isShifting:!1,transmissionMode:"automatic",revLimiterActive:!1,wheelSlip:0,launchControlActive:!1}}}new cn;
